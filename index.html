<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="light dark">
  <title>ุชูููุฏ ุงูุฏูุงุฆู ูู ุชุญููู ูุณุงุฆู ุนูู ุงูููุงู - ุงูุฅูุงู ุงููุงูุดู</title>

  <!-- Optional: Use local fonts if available; otherwise fallback -->
  <style>
    /* =========================================================
       Base reset + global settings
       ========================================================= */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Amiri', 'Traditional Arabic', 'Scheherazade New', serif;
      line-height: 2;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      color: #333;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* =========================================================
       Header
       ========================================================= */
    .header {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 3rem 2rem;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
    }
    .header::before {
      content: '';
      position: absolute;
      inset: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.05" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,138.7C960,139,1056,117,1152,101.3C1248,85,1344,75,1392,69.3L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
      opacity: 0.12;
    }
    .header h1 {
      font-size: 2.6rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      position: relative; z-index: 1;
    }
    .header .subtitle {
      font-size: 1.2rem;
      opacity: 0.95;
      margin-bottom: 0.5rem;
      position: relative; z-index: 1;
    }
    .header .author {
      font-size: 1.4rem;
      color: #ffd700;
      margin-top: 1rem;
      font-weight: bold;
      position: relative; z-index: 1;
    }

    /* =========================================================
       Navigation
       ========================================================= */
    .nav {
      background: rgba(255,255,255,0.98);
      padding: 0.85rem 1rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }
    .nav ul {
      list-style: none;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.6rem;
    }
    .nav a {
      color: #1e3c72;
      text-decoration: none;
      padding: 0.6rem 1.05rem;
      border-radius: 999px;
      transition: all 0.25s;
      font-weight: 800;
      border: 2px solid transparent;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      white-space: nowrap;
    }
    .nav a:hover {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30,60,114,0.3);
    }

    /* =========================================================
       Layout
       ========================================================= */
    .container { max-width: 1200px; margin: 2rem auto; padding: 0 1.2rem; }
    .section {
      background: white;
      margin: 2rem 0;
      padding: 2.2rem;
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      transition: transform 0.25s, box-shadow 0.25s;
    }
    .section:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.18); }

    .section-title {
      color: #1e3c72;
      font-size: 2rem;
      margin-bottom: 1.2rem;
      padding-bottom: 0.8rem;
      border-bottom: 3px solid #ffd700;
      display: inline-block;
    }

    .content-box {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: 1.6rem;
      border-radius: 10px;
      margin: 1.2rem 0;
      border-right: 5px solid #1e3c72;
      line-height: 2.15;
    }

    .highlight {
      background: linear-gradient(120deg, #ffd700 0%, #ffed4e 100%);
      padding: 0.15rem 0.45rem;
      border-radius: 4px;
      font-weight: 900;
    }

    /* =========================================================
       Chapters (accordion)
       ========================================================= */
    .chapter {
      background: white;
      padding: 1.2rem;
      margin: 1rem 0;
      border-radius: 10px;
      border-right: 4px solid #2a5298;
      transition: all 0.25s;
      cursor: pointer;
      position: relative;
      outline: none;
    }
    .chapter:hover {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      transform: translateX(-4px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .chapter:focus-visible {
      box-shadow: 0 0 0 4px rgba(255,215,0,0.45), 0 8px 30px rgba(0,0,0,0.12);
    }

    .chapter-title {
      font-size: 1.35rem;
      color: #1e3c72;
      font-weight: 900;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .chapter-title small {
      font-size: 0.95rem;
      font-weight: 800;
      opacity: 0.75;
    }

    .chapter-content {
      display: none;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 2px dashed #ddd;
      line-height: 2.15;
    }
    .chapter.active .chapter-content { display: block; animation: fadeIn 0.35s; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(-8px);} to {opacity:1; transform: translateY(0);} }

    /* =========================================================
       Blocks
       ========================================================= */
    .definition {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      padding: 1.2rem;
      margin: 1rem 0;
      border-radius: 10px;
      border-right: 5px solid #2196f3;
    }
    .definition-title {
      font-weight: 900;
      color: #1565c0;
      font-size: 1.15rem;
      margin-bottom: 0.4rem;
    }

    .quote {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      padding: 1.2rem;
      margin: 1.2rem 0;
      border-right: 5px solid #ff9800;
      border-radius: 10px;
      font-style: italic;
      position: relative;
    }
    .quote::before {
      content: 'โ';
      font-size: 3rem;
      position: absolute;
      top: -12px;
      right: 12px;
      color: #ff9800;
      opacity: 0.28;
    }

    .reference {
      background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 10px;
      border-right: 4px solid #9c27b0;
      font-size: 0.98rem;
    }

    /* =========================================================
       Search / Toolbar
       ========================================================= */
    .search-box { margin: 1.6rem 0 0.8rem; text-align: center; }
    .search-box input {
      padding: 1rem 1.6rem;
      font-size: 1.1rem;
      border: 2px solid #1e3c72;
      border-radius: 999px;
      width: 100%;
      max-width: 760px;
      font-family: inherit;
      transition: all 0.2s;
      background: rgba(255,255,255,0.98);
    }
    .search-box input:focus {
      outline: none;
      box-shadow: 0 0 20px rgba(30,60,114,0.25);
      transform: scale(1.01);
    }

    .toolbar {
      display: flex;
      gap: 0.6rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 0.8rem 0 1.2rem;
    }
    .btn {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 999px;
      font-size: 1.05rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      font-weight: 900;
    }
    .btn:hover { transform: scale(1.03); box-shadow: 0 6px 18px rgba(30,60,114,0.35); }
    .btn.secondary {
      background: white;
      color: #1e3c72;
      border: 2px solid #1e3c72;
    }

    /* =========================================================
       Search results panel
       ========================================================= */
    .search-results{
      background: rgba(255,255,255,0.96);
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      padding: 1rem;
      margin: 0.6rem auto 1.8rem;
      max-width: 980px;
      display: none;
    }
    .search-results-head{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 1rem;
      padding-bottom: .8rem;
      border-bottom: 2px dashed rgba(0,0,0,0.12);
      margin-bottom: .8rem;
    }
    .sr-title{ font-weight: 900; color: #1e3c72; font-size: 1.15rem; }
    .sr-meta{ opacity: .75; font-weight: 900; }
    .sr-item{
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 12px;
      padding: .9rem 1rem;
      margin: .6rem 0;
      border-right: 5px solid #1e3c72;
      cursor: pointer;
      transition: transform .2s, box-shadow .2s;
    }
    .sr-item:hover{ transform: translateX(-4px); box-shadow: 0 8px 18px rgba(0,0,0,0.12); }
    .sr-item h4{ margin: 0 0 .3rem; color:#1e3c72; font-weight: 900; font-size: 1.05rem; }
    .sr-item p{ margin: 0; opacity: .9; }
    .sr-pill{
      display:inline-block;
      padding: .15rem .55rem;
      border-radius: 999px;
      font-weight: 900;
      background: #ffd700;
      margin-inline-start: .4rem;
    }

    /* =========================================================
       Cards / Grid
       ========================================================= */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.2rem;
      margin: 1.2rem 0;
    }
    .card {
      background: white;
      padding: 1.4rem;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.25s;
      border-top: 4px solid #1e3c72;
    }
    .card:hover { transform: translateY(-6px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    .card-title { color: #1e3c72; font-size: 1.35rem; margin-bottom: 0.7rem; font-weight: 900; }

    /* =========================================================
       TOC (definitions)
       ========================================================= */
    .toc {
      background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
      padding: 1.6rem;
      border-radius: 12px;
      margin: 1.4rem 0;
      border: 3px solid #fdd835;
    }
    .toc-title {
      font-size: 1.55rem;
      color: #f57f17;
      margin-bottom: 1rem;
      font-weight: 900;
    }
    .toc ul { list-style: none; }
    .toc li {
      padding: 0.75rem 0.9rem;
      margin: 0.5rem 0;
      background: white;
      border-radius: 8px;
      transition: all 0.25s;
      cursor: pointer;
      border-right: 4px solid transparent;
      font-weight: 900;
    }
    .toc li:hover {
      background: #fffde7;
      border-right-color: #f57f17;
      transform: translateX(-4px);
    }

    /* =========================================================
       Highlight mark for search
       ========================================================= */
    mark.hl {
      background: #ffed4e;
      padding: 0 0.15rem;
      border-radius: 4px;
    }

    /* =========================================================
       Footer
       ========================================================= */
    .footer {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      margin-top: 3rem;
    }
    .muted { opacity: 0.85; font-size: 0.95rem; }

    /* =========================================================
       Reading mode + print
       ========================================================= */
    body.reading .container{ max-width: 860px; }
    body.reading .section{ padding: 2.6rem; }
    body.reading{ font-size: 1.12rem; }
    body.reading .section-title{ font-size: 2.1rem; }

    @media print{
      .nav, .toolbar, .search-box, .search-results, .footer a, .kbd-hint { display:none !important; }
      body{ background: white !important; }
      .section{ box-shadow:none !important; margin: 0.8rem 0 !important; }
      .chapter-content{ display:block !important; }
    }

    /* =========================================================
       Dark theme overrides (toggle)
       ========================================================= */
    :root[data-theme="dark"] body { color: #e7eef7; }
    :root[data-theme="dark"] .section { background: rgba(20,28,36,0.92); }
    :root[data-theme="dark"] .content-box,
    :root[data-theme="dark"] .definition,
    :root[data-theme="dark"] .quote,
    :root[data-theme="dark"] .reference,
    :root[data-theme="dark"] .toc,
    :root[data-theme="dark"] .card,
    :root[data-theme="dark"] .search-results {
      background: rgba(255,255,255,0.06);
      border-right-color: rgba(255,215,0,0.55);
    }
    :root[data-theme="dark"] .nav { background: rgba(10,14,18,0.85); }
    :root[data-theme="dark"] .nav a { color: #ffd700; }
    :root[data-theme="dark"] .search-box input {
      background: rgba(255,255,255,0.08);
      color: #fff;
      border-color: rgba(255,215,0,0.6);
    }
    :root[data-theme="dark"] .btn.secondary { background: rgba(255,255,255,0.08); color: #ffd700; border-color: rgba(255,215,0,0.6); }
    :root[data-theme="dark"] .sr-item { background: rgba(255,255,255,0.08); }

    /* =========================================================
       Responsive tweaks
       ========================================================= */
    @media (max-width: 768px) {
      .header h1 { font-size: 1.9rem; }
      .section { padding: 1.4rem; }
      .nav a { padding: 0.55rem 0.95rem; }
      .chapter-title { font-size: 1.2rem; }
    }

    /* Small keyboard hints */
    .kbd-hint{
      text-align:center;
      margin-top: .4rem;
      font-weight: 900;
      opacity: .75;
      font-size: .92rem;
    }
    .kbd {
      display:inline-block;
      padding: .1rem .45rem;
      border-radius: .5rem;
      border: 2px solid rgba(30,60,114,.25);
      background: rgba(255,255,255,.85);
      font-weight: 900;
      margin: 0 .2rem;
    }
  </style>
</head>

<body>
  <div class="header" id="top">
    <h1>ุชูููุฏ ุงูุฏูุงุฆู ูู ุชุญููู ูุณุงุฆู ุนูู ุงูููุงู</h1>
    <div class="subtitle">ูุชุฃุตูู ูุนุงูู ุฏูุงุฆู ุงูุฅููุงู</div>
    <div class="author">
      ุงูุดูุฎ ุงูุฅูุงู ุงูุฃุณุชุงุฐ ุงูุฌููู ุณูู ุงูุญู ูุงุตุฑ ุงูุดุฑูุนุฉ<br/>
      ุฃุจู ุงูุซูุงุก ูุญููุฏ ุจู ุฒูุฏ ุงููุงูุดู
    </div>
  </div>

  <nav class="nav" aria-label="ุงูุชููู">
    <ul>
      <li><a href="#biography">๐ ุชุฑุฌูุฉ ุงููุคูู</a></li>
      <li><a href="#introduction">๐ช ุงููุฏุฎู</a></li>
      <li><a href="#definitions">๐ ุงูุชุนุฑููุงุช</a></li>
      <li><a href="#chapters">๐งฉ ุงููุตูู</a></li>
      <li><a href="#proofs">๐ง ุงูุฃุฏูุฉ</a></li>
    </ul>
  </nav>

  <div class="container">
    <div class="search-box">
      <input type="text" placeholder="ุงุจุญุซ ูู ุงููุชุงุจ... (ูุซุงู: ุงูุฏูููุ ุงูุญููุ ุญุฏูุซ ุงูุนุงูู)" id="searchInput" autocomplete="off">
      <div class="kbd-hint">
        ุงุฎุชุตุงุฑุงุช: <span class="kbd">/</span> ููุจุญุซ โข <span class="kbd">Esc</span> ููุณุญ โข <span class="kbd">Ctrl</span>+<span class="kbd">K</span> ูุชุญ/ุฅุบูุงู ุงููู
      </div>
    </div>

    <div class="toolbar">
      <button class="btn" id="openAllBtn" type="button">ูุชุญ ุงููู</button>
      <button class="btn secondary" id="closeAllBtn" type="button">ุฅุบูุงู ุงููู</button>
      <button class="btn secondary" id="clearSearchBtn" type="button">ูุณุญ ุงูุจุญุซ</button>
      <button class="btn secondary" id="readingBtn" type="button">ูุถุน ุงููุฑุงุกุฉ</button>
      <button class="btn secondary" id="printBtn" type="button">ุทุจุงุนุฉ / PDF</button>
      <button class="btn secondary" id="themeBtn" type="button" title="ุชุจุฏูู ุงููุธูุฑ">๐/โ๏ธ</button>
    </div>

    <!-- โ Search results live panel -->
    <div class="search-results" id="searchResults" aria-live="polite">
      <div class="search-results-head">
        <div class="sr-title">ูุชุงุฆุฌ ุงูุจุญุซ</div>
        <div class="sr-meta" id="srMeta">โ</div>
      </div>
      <div class="sr-list" id="srList"></div>
    </div>

    <!-- Biography -->
    <section id="biography" class="section">
      <h2 class="section-title">ุชุฑุฌูุฉ ุงููุคูู</h2>

      <div class="content-box">
        <p><span class="highlight">ูู ุงูุดูุฎ ุงูุฅูุงู ุงูุฃุณุชุงุฐ ุงูุฌููู</span> ุณูู ุงูุญู ูุงุตุฑ ุงูุดุฑูุนุฉุ ุฃุจู ุงูุซูุงุก ูุญููุฏ ุจู ุฒูุฏ ุงููุงูุดู.</p>
      </div>

      <div class="definition">
        <div class="definition-title">ูุดุฃุชู</div>
        <p>
          ูุดุฃ ุงูุฅูุงู ุงููุงูุดู ูู ุจูุงุฏ ูุง ูุฑุงุก ุงูููุฑุ ูู ุงููุฑูุฉ ุงูุชู ููุณุจ ุฅูููุง ููู
          <span class="highlight">ยซูุงูุดยป</span> ูู ูุฑู ููุฑูุบูุงููุฉูุ ูุชููู ุนู ูุดุงูุฎ ุฏูุงุฑู
          ููุดูุฑ ุฅูููู ุฃุญูุงูุงู ุจูยซูุดุงูุฎ ูุง ูุฑุงุก ุงูููุฑยป ุฃู ยซูุดุงูุฎ ุณูุฑููุฏยป ุฃู ยซูุดุงูุฎ ุฏูุงุฑูุงยป. 
        </p>
      </div>

      <div class="quote">
        ูุงู ูููุงุฑู ุฃุญูุงูุงู ุจูู ุฃููุงู ูููุงุก ุณูุฑููุฏ ููููุงุก ุงูุนุฑุงูุ ููุฐูุฑ ุงุฎุชูุงู ููุงูุฌูู ูู ุจุนุถ ูุณุงุฆู ุงูุฃุตูู.
      </div>

      <div class="content-box">
        <h3>ุชุฃุฑูุฎ ููุงุฏุชู ูููุงุชู</h3>
        <p>ูู ุชุฐูุฑ ูุชุจ ุงูุชุฑุงุฌู ุชุงุฑูุฎ ููุงุฏุชู ูููุงุชู ุนูู ูุฌูู ูุงุทุน.</p>
        <p>
          ูุฑุฏ ูู ุจุนุถ ุงููุณุฎ ุฃูู ุชููู ูุฌุฑ ููู ุงูุงุซููู ูู ุฑูุถุงู ุณูุฉ
          <span class="highlight">522ูู</span>ุ ููุงู ุงุจู ุฅุญุฏู ูุซูุงููู ุณูุฉ (ูุน ุงุฎุชูุงู ูู ุถุจุท ุงูููู ุฏุงุฎู ุจุนุถ ุงููููู).
        </p>
        <p>ููุฑุฌูุญ ุจุนุถ ุงููุญูููู ุฃูู ุนุงุด ูู ุฃูุงุฎุฑ ุงููุฑู ุงูุฎุงูุณ ูุฃูุงุฆู ุงูุณุงุฏุณ ุงููุฌุฑู.</p>
      </div>
    </section>

    <!-- Introduction -->
    <section id="introduction" class="section">
      <h2 class="section-title">ูุฏุฎู</h2>

      <div class="content-box">
        <p>
          ูุจู ุงูุดุฑูุน ูุง ุจุฏ ูู ุงููููู ุนูุฏ ุงููุตุทูุญุงุช: ุชุนุฑูู ุนูู ุงูููุงูุ ููุถูุนูุ ุบุงูุชูุ
          ุญุชู ูุง ูุถูุน ุงูุทุงูุจ ูู ุงูุจุญุฑ ูุจู ูุง ููุจุณ ุณุชุฑุฉ ุงููุฌุงุฉ.
        </p>
      </div>

      <div class="grid">
        <div class="card">
          <h3 class="card-title">ุชุนุฑูู ุนูู ุงูููุงู ุจุญุณุจ ููุถูุนู</h3>
          <p>ูู ุนูู ูุจุญุซ ููู ุนู ุฐุงุช ุงููู ุชุนุงููุ ูุตูุงุชูุ ูุฃุญูุงู ุงูููููุงุชุ ูู ุงููุจุฏุฃ ูุงููุนุงุฏ ุนูู ูุงููู ุงูุฅุณูุงู.</p>
        </div>

        <div class="card">
          <h3 class="card-title">ุชุนุฑูู ุนูู ุงูููุงู ุจุญุณุจ ุบุงูุชู</h3>
          <p>ูู ุนูู ููุชุฏุฑ ูุนู ุนูู ุฅุซุจุงุช ุงูุนูุงุฆุฏ ุงูุฏูููุฉ ุจุฅูุฑุงุฏ ุงูุญุฌุฌ ูุฏูุน ุงูุดุจู.</p>
        </div>

        <div class="card">
          <h3 class="card-title">ููุถูุน ุนูู ุงูููุงู</h3>
          <p>ููู: ุฐุงุช ุงููู ุชุนุงูู ูู ุญูุซ ูุง ููุญูู ุนููู ูู ุงูุตูุงุช ูุฅุฑุณุงู ุงูุฑุณู ูุฎูู ุงูุฃูุนุงู.</p>
        </div>

        <div class="card">
          <h3 class="card-title">ุบุงูุฉ ุนูู ุงูููุงู</h3>
          <p>
            <strong>ูก</strong> ุงูุชุฑูู ูู ุงูุชูููุฏ ุฅูู ุงูุฅููุงู<br/>
            <strong>ูข</strong> ุฅุฑุดุงุฏ ุงููุณุชุฑุดุฏูู ูุฅูุฒุงู ุงููุนุงูุฏูู ุจุงูุญุฌุฉ<br/>
            <strong>ูฃ</strong> ุญูุธ ููุงุนุฏ ุงูุฏูู ูู ุดุจู ุงููุจุทููู<br/>
            <strong>ูค</strong> ูููู ุฃุณุงุณ ุงูุนููู ุงูุดุฑุนูุฉ
          </p>
        </div>
      </div>
    </section>

    <!-- Definitions -->
    <section id="definitions" class="section">
      <h2 class="section-title">ุงูุชุนุฑููุงุช ุงูุฃุณุงุณูุฉ</h2>

      <div class="toc" aria-label="ููุฑุณ">
        <div class="toc-title">ููุฑุณ ุงูุชุนุฑููุงุช</div>
        <ul>
          <li data-goto="dalil">ุงูุฏููู</li>
          <li data-goto="hukm">ุงูุญูู</li>
          <li data-goto="wajib">ุงููุงุฌุจ ูุงููุณุชุญูู ูุงููููู</li>
          <li data-goto="ilm">ุงูุนูู (ุชูููุฏ)</li>
        </ul>
      </div>

      <div class="chapter" id="dalil" tabindex="0" role="button" aria-expanded="false">
        <div class="chapter-title">
          <span>ุงูุฏููู</span>
          <small>ุงุถุบุท ูููุชุญ/ุงูุฅุบูุงู</small>
        </div>
        <div class="chapter-content">
          <div class="definition">
            <div class="definition-title">ูุบุฉ</div>
            <p>ุงููุฑุดุฏ. ููุฏ ููุทูู ุจูุนูู ุงูุฏุงู.</p>
          </div>

          <div class="definition">
            <div class="definition-title">ุงุตุทูุงุญุงู</div>
            <p><strong>ููู:</strong> ูุง ููุฑุดุฏ ุฅูู ูุนุฑูุฉ ุงูุบุงุฆุจ ุนู ุงูุญูุงุณ ููุง ูุง ูุนุฑู ุจุงุถุทุฑุงุฑ.</p>
            <p><strong>ูุชุญูููุงู:</strong> ูู ูุง ููุชูุตู ุจู ูู ูุนููู ุฅูู ูุทููุจ ุจุฅุญูุงู ุงููุธุฑ.</p>
          </div>

          <div class="content-box">
            <h4>ุฃูุณุงู ุงูุฏููู</h4>
            <p><strong>ุงูุฏููู ุงูุนููู:</strong> ููุฏูุงุชู ุนูููุฉ (ูุง ูุชููู ุนูู ุงูุณูุน).</p>
            <p><strong>ุงูุฏููู ุงูุณูุนู:</strong> ูุฑูุจ ูู ููุฏูุงุช ุนูููุฉ ูุณูุนูุฉ.</p>
          </div>

          <div class="reference">
            <strong>ูู ุญูุซ ุงููุทุน ูุงูุธู (ุฎุงุตุฉ ูู ุงูุณูุนู):</strong><br/>
            ูก) ูุทุนู ุงูุซุจูุช ูุทุนู ุงูุฏูุงูุฉ<br/>
            ูข) ูุทุนู ุงูุซุจูุช ุธูู ุงูุฏูุงูุฉ<br/>
            ูฃ) ุธูู ุงูุซุจูุช ูุทุนู ุงูุฏูุงูุฉ<br/>
            ูค) ุธูู ุงูุซุจูุช ุธูู ุงูุฏูุงูุฉ
          </div>
        </div>
      </div>

      <div class="chapter" id="hukm" tabindex="0" role="button" aria-expanded="false">
        <div class="chapter-title">
          <span>ุงูุญูู</span>
          <small>ุงุถุบุท ูููุชุญ/ุงูุฅุบูุงู</small>
        </div>
        <div class="chapter-content">
          <div class="definition">
            <div class="definition-title">ุชุนุฑูู ุงูุญูู</div>
            <p><strong>ุนูุฏ ุฃูู ุงููู:</strong> ุฅุซุจุงุช ุฃูุฑ ูุฃูุฑ ุฃู ูููู ุนููุ ูุซู: ุงูุนูู ูุงุฌุจ ููู ุชุนุงููุ ูุดุฑูู ุงูุจุงุฑู ูุญุงู.</p>
            <p><strong>ุนูุฏ ุงูููุงุทูุฉ:</strong> ุฅุฏุฑุงู ุฃู ุงููุณุจุฉ ูุงูุนุฉ ุฃู ููุณุช ุจูุงูุนุฉ.</p>
            <p><strong>ุนูุฏ ุงูุฃุตููููู:</strong> ุฎุทุงุจ ุงููู ุชุนุงูู ุงููุชุนูู ุจุฃูุนุงู ุงููููููู: ุงูุชุถุงุก ุฃู ุชุฎููุฑุงู ุฃู ูุถุนุงู.</p>
          </div>

          <div class="content-box">
            <h4>ุฃูุณุงู ุงูุญูู (ุงูุนููู ููุง)</h4>
            <p><strong>ุงููุฌูุจ:</strong> ูุง ูู ููุจู ุงูุงูุชูุงุก ูู ุฐุงุชู.</p>
            <p><strong>ุงูุงุณุชุญุงูุฉ:</strong> ูุง ูู ููุจู ุงูุซุจูุช ูู ุฐุงุชู.</p>
            <p><strong>ุงูุฅููุงู:</strong> ูุง ููุจู ุงูุซุจูุช ูุงูุงูุชูุงุก ูุฐุงุชู.</p>
          </div>

          <div class="reference">
            <strong>ูุตุงุฏุฑ ุงูุญูู:</strong> ูุถุนู (ูุงูุดุฑุน ูุงูููุงููู) โ ุนููู (ูุงูููุทู) โ ุนุงุฏู (ูุงูุงูุชุฑุงู ุงููุดุงูุฏ). 
          </div>
        </div>
      </div>

      <div class="chapter" id="wajib" tabindex="0" role="button" aria-expanded="false">
        <div class="chapter-title">
          <span>ุงููุงุฌุจ ูุงููุณุชุญูู ูุงููููู</span>
          <small>ุงุถุบุท ูููุชุญ/ุงูุฅุบูุงู</small>
        </div>
        <div class="chapter-content">
          <div class="definition">
            <div class="definition-title">ุชุนุฑููุงุช ูุฎุชุตุฑุฉ</div>
            <p><strong>ุงููุงุฌุจ:</strong> ูุง ูู ููุจู ุงูุงูุชูุงุก ูู ุฐุงุชู.</p>
            <p><strong>ุงููุณุชุญูู:</strong> ูุง ูู ููุจู ุงูุซุจูุช ูู ุฐุงุชู.</p>
            <p><strong>ุงููููู:</strong> ูุง ููุจู ุงูุซุจูุช ูุงูุงูุชูุงุก ูุฐุงุชู.</p>
          </div>

          <div class="content-box">
            <h4>ุชูุณูู ุงููุงุฌุจ ูุงููุณุชุญูู: ูุฐุงุชู ููุบูุฑู</h4>
            <p>
              <strong>ุงููุงุฌุจ ูุฐุงุชู:</strong> ููุฌูุฏ ุงููู ุชุนุงูู.<br/>
              <strong>ุงููุงุฌุจ ูุบูุฑู:</strong> ูุง ุตุงุฑ ูุงุฌุจุงู ุจุงููุธุฑ ุฅูู ุชุนููู ุงูุนูู/ุงูุฅุฑุงุฏุฉ ุจู ูู ุงูููููุงุช (ูุซุงู: ูุฌูุฏูุง ุจุนุฏ ุชุฎุตูุตู).<br/>
              <strong>ุงูุงูุชูุงุน ูุฐุงุชู:</strong> ูุงูุดุฑูู ููู ุชุนุงูู.<br/>
              <strong>ุงูุงูุชูุงุน ูุบูุฑู:</strong> ูููู ุจุงูุฐุงุช ููู ุชุนููู ุงูุนูู ุจุนุฏู ูููุนู (ูุซู ุฃูุซูุฉ ุงูุชุฑุงุถูุฉ ุชูุฐูุฑ ูู ุงูุดุฑูุญ).
            </p>
          </div>

          <div class="reference">
            ุชูุจูู ููู: ุงููุงุฌุจ ุจุงูุบูุฑ ูุงูููุชูุน ุจุงูุบูุฑ <strong>ููููุงู ุจุงูุฐุงุช</strong> ุฃุตูุงูุ ููุง ููููุจ ุงููููู ุฐุงุชุงู ุฅูู ูุงุฌุจ ุฐุงุชุงู ุฃู ููุชูุน ุฐุงุชุงู. 
          </div>
        </div>
      </div>

      <div class="chapter" id="ilm" tabindex="0" role="button" aria-expanded="false">
        <div class="chapter-title">
          <span>ุงูุนูู (ุชูููุฏ ุณุฑูุน)</span>
          <small>ุงุถุบุท ูููุชุญ/ุงูุฅุบูุงู</small>
        </div>
        <div class="chapter-content">
          <div class="definition">
            <div class="definition-title">ููุงุฐุง ูุจุฏุฃ ุจูุ</div>
            <p>
              ูุฃู ูุซูุฑุงู ูู ูุจุงุญุซ ุงูููุงู ูุจูู ุนูู: ูู ูุฐุง ููุนูู ุถุฑูุฑุฉ ุฃู ูุธุฑุงูุ ููู ุทุฑููู ุญุณ ุฃู ุนูู ุฃู ุฎุจุฑุ
            </p>
          </div>

          <div class="content-box">
            <h4>ุฃุณุจุงุจ ุงูุนูู ุจุงูุญูุงุฆู (ูุฎุชุตุฑ)</h4>
            <p>ุฐููุฑ ุฃู ุฃุณุจุงุจ ุงูุนูู ุซูุงุซุฉ: <strong>ุงูุญูุงุณ ุงูุณูููุฉ</strong>ุ ู<strong>ุงูุนููู ุงููุณุชูููุฉ</strong>ุ ู<strong>ุงูุฎุจุฑ ุงูุตุงุฏู</strong>.</p>
          </div>

          <div class="quote">
            ุฅุฐุง ุญุงููุช ุชูุบู ุงูุนูู ูููโฆ ูุจุฃู ุดูุก ุณุชุซุจุช ุฃู โุงูุนูู ูุง ูููุนโุ (ูุนูุ ูุฐุง ููุณ ุงููุฎู ุงููุฏููโฆ ููุง ูุฒุงู ูุนูู ุจููุงุกุฉ.)
          </div>
        </div>
      </div>
    </section>

    <!-- Chapters -->
    <section id="chapters" class="section">
      <h2 class="section-title">ูุตูู ุงููุชุงุจ</h2>

      <div class="chapter" id="ch1" tabindex="0" role="button" aria-expanded="false">
        <div class="chapter-title">
          <span>ูุตู ูู ุซุจูุช ุญูุงุฆู ุงูุฃุดูุงุก</span>
          <small>ุงุถุบุท ูููุชุญ/ุงูุฅุบูุงู</small>
        </div>
        <div class="chapter-content">
          <div class="content-box">
            <p>ุญูุงุฆู ุงูุฃุดูุงุก ุซุงุจุชุฉุ ููู ูุฐูุจ ุนุงูุฉ ุงูุนููุงุก.</p>

            <h4>ุงูุนูุงุฏูุฉ ูุดุจูุชูู</h4>
            <p>ูุงูุช ุทุงุฆูุฉ: ูุง ุญูููุฉ ููุฃุดูุงุกุ ูุงุญุชุฌูุง ุจุงุฎุชูุงู ุงูุฅุฏุฑุงู: ูุงูุฃุญูู ูุฑู ุงูุดูุก ุดูุฆููโฆ</p>

            <div class="quote">
              ููุฌุงุจ: ูู ูููููู ุญูููุฉุ ุฅู ูุงููุง ูุงุ ุณูุท. ูุฅู ูุงููุง ูุนูุ ุฃุซุจุชูุง ุญูููุฉ ุดูุก ุนูู ุงูุฃูู.
            </div>
          </div>

          <div class="reference">
            ุงูุฑุฏ ุนูู ุงููุงุฃุฏุฑูุฉ ูุฐูู: โูุง ูุฏุฑูโ ุฅู ูุงูุช ูุง ุญูููุฉ ููุง ููุง ููุงูุ ูุฅู ูุงูุช ููุง ุญูููุฉ ููุฏ ุซุจุชุช ุญูููุฉ ุดูุก.
          </div>
        </div>
      </div>

      <div class="chapter" id="ch2" tabindex="0" role="button" aria-expanded="false">
        <div class="chapter-title">
          <span>ูุตู ูู ุฅุซุจุงุช ุญุฏูุซ ุงูุนุงูู ูุซุจูุช ุงูุตุงูุน ููุฏูู</span>
          <small>ุงุถุบุท ูููุชุญ/ุงูุฅุบูุงู</small>
        </div>
        <div class="chapter-content">
          <div class="definition">
            <div class="definition-title">ุชุนุฑูู ุงูุนุงูู</div>
            <p>ุงูุนุงูู: ูุง ุณูู ุงููู ุชุนุงูู ูู ุงูุณููุงุช ูุงูุฃุฑุถูู ููุง ูููุง.</p>
          </div>

          <div class="content-box">
            <h4>ุฃูุณุงู ุงูุนุงูู ุนูุฏ ุงููุชููููู</h4>
            <p><strong>ุงูุฃุนุฑุงุถ:</strong> ูุงูููู ูุงูุทุนู ูุงูุญุฑูุฉ ูุงูุณูููโฆ</p>
            <p><strong>ุงูุฌูุงูุฑ:</strong> ุงูุฌุฒุก ุงูุฐู ูุง ูุชุฌุฒุฃ (ุจุญุณุจ ุงุตุทูุงุญูู).</p>
            <p><strong>ุงูุฃุฌุณุงู:</strong> ุงููุฑูุจ ูู ุฌุฒุฆูู ูุฃูุซุฑ.</p>
          </div>

          <div class="quote">
            ุงูุฏููู ุนูู ุญุฏูุซ ุงูุนุงูู (ูุฎุชุตุฑ): ุงูุฃุนุฑุงุถ ุชุชุนุงูุจ (ุณูุงุฏ/ุจูุงุถุ ุญุฑูุฉ/ุณููู) ููู ุญุงุฏุซุฉุ ููุง ูุง ูุฎูู ุนู ุงูุญูุงุฏุซ ููู ุญุงุฏุซ.
          </div>

          <div class="reference">
            ููู ุซู: ุฅุฐุง ุซุจุช ุญุฏูุซ ุงูุนุงูู ุซุจุช ุงุญุชูุงุฌู ุฅูู ููุญุฏูุซุ ูุฅุฐุง ุซุจุช ุงูููุญุฏูุซ ูุฒู ููุฏููู ููุทุน ุงูุชุณูุณู ูุงูุฏูุฑ.
          </div>
        </div>
      </div>
    </section>

    <!-- Proofs -->
    <section id="proofs" class="section">
      <h2 class="section-title">ุงูุฃุฏูุฉ (ููุฎุต ูุฑุชุจ)</h2>

      <div class="content-box">
        <p>
          ูุฐุง ูุณู โููุณู ูู ุงูุฎูุทโ ุจุฏู ูุง ุชุธู ุชุฌูุนู ูู ูู ูุตู: ููู ุชูุจูู ุงูุญุฌุฉ ูู ุงููุชุงุจุ ููุง ุงูุฐู ููุฏูู ุนูู ูุงุฐุงุ
        </p>
      </div>

      <div class="grid">
        <div class="card">
          <h3 class="card-title">ูก) ุชุฑุชูุจ ุงูุงุณุชุฏูุงู</h3>
          <p>
            ูุซุจุช ุฃููุงู ุซุจูุช ุงูุญูุงุฆู ูุทุฑู ุงูุนูู (ุญุณ/ุนูู/ุฎุจุฑ)ุ ุซู ููุชูู ูุจูุงุก ุงูุฏููู ุงูุนููู ุนูู ุญุฏูุซ ุงูุนุงููุ
            ุซู ูุซุจุช ุงูุตุงูุนุ ุซู ููุฏููุ ุซู ูุง ูุชูุฑุน ุนูู ุฐูู.
          </p>
        </div>

        <div class="card">
          <h3 class="card-title">ูข) ุญุฏูุซ ุงูุนุงูู</h3>
          <p>
            ุงูุฃุนุฑุงุถ ุญุงุฏุซุฉ ูุชุจุฏููุงุ ูุงูุฃุนูุงู ูุง ุชุฎูู ุนู ุงูุฃุนุฑุงุถุ ููุง ูุง ูุฎูู ุนู ุงูุญูุงุฏุซ ููู ุญุงุฏุซ.
          </p>
        </div>

        <div class="card">
          <h3 class="card-title">ูฃ) ุซุจูุช ุงูุตุงูุน</h3>
          <p>
            ุงูุญุงุฏุซ ูุง ุจุฏ ูู ูู ููุญุฏูุซุ ูุงุณุชุญุงูุฉ ุฃู ููุญุฏุซ ุงูุดูุก ููุณูุ ูุฃู ุงูุนุฏู ูุง ููุนูุ ููุฃู ุฅูุฌุงุฏ ุงูููุฌูุฏ ุชุญุตูู ุญุงุตู.
          </p>
        </div>

        <div class="card">
          <h3 class="card-title">ูค) ููุฏู ุงูุตุงูุน</h3>
          <p>
            ูู ูุงู ุงูุตุงูุน ุญุงุฏุซุงู ูุงุญุชุงุฌ ุฅูู ููุญุฏูุซุ ูููุฒู ุงูุฏูุฑ ุฃู ุงูุชุณูุณูุ ูููุงููุง ุจุงุทูุ ูุซุจุช ููุฏูู.
          </p>
        </div>
      </div>

      <div class="reference">
        ููุงุญุธุฉ ูููุฌูุฉ: ุนูุฏ ุงูุชุนุงุฑุถ ุจูู โุนููู/ููููโ ูููุธุฑ ูููุทุน ูุงูุธูุ ููููุฏู ุงููุทุนูุ ูููุคููู ุงูุธูู ุฃู ููุฑุฏู ูุง ูุงู ุธูู ุงูุซุจูุช ุฅุฐุง ุฎุงูู ุงููุทุนู.
      </div>

      <div class="quote">
        ุฎูุงุตุฉ ุนูููุฉ: ูู ุจููุช ุงูุญุฌุฉ ูุซู ุจุฑุฌ ุฌูุบุง (ูุทุนุฉ ููู ูุทุนุฉ ุจุฏูู ุฃุณุงุณ)ุ ูุง ุชููู ุงูุฑูุญ ุฅุฐุง ุฃุณูุทุชูโฆ ููู ููุฏุณุชู.
      </div>
    </section>
  </div>

  <div class="footer">
    <div>ยฉ ุตูุญุฉ ุชุนููููุฉ ูุฎุฏูุฉ ุงููุต โ ุชุตููู ูุงุฌูุฉ ุนุฑุจูุฉ RTL</div>
    <div class="muted">ุชูููุญ: ุงุถุบุท ุนูู ุนูุงููู ุงููุตูู ููุชุญูุงุ ูุงุณุชุฎุฏู ุงูุจุญุซ ููุชุตููุฉ ูุงูุฅุจุฑุงุฒ.</div>
    <div class="muted"><a href="#top" style="color:#ffd700; font-weight:900; text-decoration:none;">โฌ ุงูุนูุฏุฉ ููุฃุนูู</a></div>
  </div>

  <script>
    /* =========================================================
       Helpers
       ========================================================= */
    function scrollToSection(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.scrollIntoView({ behavior: "smooth", block: "start" });
      el.style.boxShadow = "0 0 0 4px rgba(255, 215, 0, 0.35)";
      setTimeout(() => el.style.boxShadow = "", 650);
    }

    function setChapterOpen(chapterEl, open) {
      if (!chapterEl) return;
      chapterEl.classList.toggle("active", open);
      chapterEl.setAttribute("aria-expanded", open ? "true" : "false");
    }

    function clearHighlights(root) {
      const marks = root.querySelectorAll("mark.hl");
      marks.forEach(m => m.replaceWith(document.createTextNode(m.textContent)));
    }

    function highlightTerm(root, term) {
      if (!term) return;
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
        acceptNode: (node) => {
          if (!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
          const parent = node.parentElement;
          if (!parent) return NodeFilter.FILTER_REJECT;
          if (["SCRIPT","STYLE"].includes(parent.tagName)) return NodeFilter.FILTER_REJECT;
          return NodeFilter.FILTER_ACCEPT;
        }
      });

      const texts = [];
      while (walker.nextNode()) texts.push(walker.currentNode);

      const escaped = term.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      const re = new RegExp(escaped, "gi");

      texts.forEach(tn => {
        const val = tn.nodeValue;
        if (!re.test(val)) return;

        const frag = document.createDocumentFragment();
        let lastIndex = 0;
        val.replace(re, (match, offset) => {
          frag.appendChild(document.createTextNode(val.slice(lastIndex, offset)));
          const mark = document.createElement("mark");
          mark.className = "hl";
          mark.textContent = match;
          frag.appendChild(mark);
          lastIndex = offset + match.length;
          return match;
        });
        frag.appendChild(document.createTextNode(val.slice(lastIndex)));
        tn.parentNode.replaceChild(frag, tn);
      });
    }

    function getSnippet(el, term, maxLen = 180){
      const txt = (el.textContent || "").replace(/\s+/g, " ").trim();
      const idx = txt.toLowerCase().indexOf(term.toLowerCase());
      if (idx < 0) return txt.slice(0, maxLen) + (txt.length > maxLen ? "โฆ" : "");
      const start = Math.max(0, idx - 60);
      const end = Math.min(txt.length, idx + maxLen);
      return (start > 0 ? "โฆ" : "") + txt.slice(start, end) + (end < txt.length ? "โฆ" : "");
    }

    /* =========================================================
       Setup DOM references
       ========================================================= */
    const chapters = Array.from(document.querySelectorAll(".chapter"));
    const searchInput = document.getElementById("searchInput");
    const clearBtn = document.getElementById("clearSearchBtn");
    const openAllBtn = document.getElementById("openAllBtn");
    const closeAllBtn = document.getElementById("closeAllBtn");
    const readingBtn = document.getElementById("readingBtn");
    const printBtn = document.getElementById("printBtn");
    const themeBtn = document.getElementById("themeBtn");

    const searchResults = document.getElementById("searchResults");
    const srList = document.getElementById("srList");
    const srMeta = document.getElementById("srMeta");

    /* =========================================================
       Chapter toggle behavior (click + keyboard)
       ========================================================= */
    function toggleChapter(ch) {
      const open = !ch.classList.contains("active");
      setChapterOpen(ch, open);
      saveOpenState();
    }

    chapters.forEach(ch => {
      ch.addEventListener("click", () => {
        const sel = window.getSelection && window.getSelection().toString();
        if (sel && sel.length > 0) return;
        toggleChapter(ch);
      });
      ch.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleChapter(ch);
        }
      });
    });

    /* =========================================================
       TOC behavior
       ========================================================= */
    document.querySelectorAll(".toc [data-goto]").forEach(li => {
      li.addEventListener("click", () => {
        const id = li.getAttribute("data-goto");
        scrollToSection(id);
        const target = document.getElementById(id);
        if (target && target.classList.contains("chapter")) setChapterOpen(target, true);
        saveOpenState();
      });
    });

    /* =========================================================
       Open/Close all
       ========================================================= */
    openAllBtn.addEventListener("click", () => {
      chapters.forEach(ch => setChapterOpen(ch, true));
      saveOpenState();
    });
    closeAllBtn.addEventListener("click", () => {
      chapters.forEach(ch => setChapterOpen(ch, false));
      saveOpenState();
    });

    /* =========================================================
       Search: highlight + filter + results list
       ========================================================= */
    function applySearch() {
      const term = (searchInput.value || "").trim();
      const root = document.body;

      clearHighlights(root);

      // reset visibility
      document.querySelectorAll(".section").forEach(sec => sec.style.display = "");
      chapters.forEach(ch => ch.style.display = "");

      srList.innerHTML = "";
      searchResults.style.display = "none";
      srMeta.textContent = "โ";

      if (!term) return;

      highlightTerm(root, term);

      const visibleSections = Array.from(document.querySelectorAll(".section"))
        .filter(sec => sec.querySelector("mark.hl"));

      document.querySelectorAll(".section").forEach(sec => {
        sec.style.display = visibleSections.includes(sec) ? "" : "none";
      });

      const results = [];
      visibleSections.forEach(sec => {
        const secCh = Array.from(sec.querySelectorAll(".chapter"));
        if (secCh.length) {
          secCh.forEach(ch => {
            const hit = ch.querySelector("mark.hl");
            if (!hit) { ch.style.display = "none"; return; }
            ch.style.display = "";
            setChapterOpen(ch, true);

            const title = ch.querySelector(".chapter-title span")?.textContent?.trim() || "ูุชูุฌุฉ";
            results.push({ title, snippet: getSnippet(ch, term), targetId: ch.id || sec.id });
          });
        } else {
          const title = sec.querySelector(".section-title")?.textContent?.trim() || "ูุชูุฌุฉ";
          results.push({ title, snippet: getSnippet(sec, term), targetId: sec.id });
        }
      });

      searchResults.style.display = "";
      srMeta.textContent = `${results.length} ูุชูุฌุฉ`;

      results.slice(0, 30).forEach((r, i) => {
        const item = document.createElement("div");
        item.className = "sr-item";
        item.innerHTML = `<h4>${r.title} <span class="sr-pill">#${i+1}</span></h4><p>${r.snippet}</p>`;
        item.addEventListener("click", () => {
          scrollToSection(r.targetId);
          const ch = document.getElementById(r.targetId);
          if (ch && ch.classList.contains("chapter")) setChapterOpen(ch, true);
          saveOpenState();
        });
        srList.appendChild(item);
      });

      if (results.length > 30) {
        const more = document.createElement("div");
        more.className = "reference";
        more.textContent = "ุฃูุธูุฑุช ุฃูู 30 ูุชูุฌุฉ ููุท โ ุถููู ุงูุจุญุซ ููุชุงุฆุฌ ุฃุฏู.";
        srList.appendChild(more);
      }
    }

    searchInput.addEventListener("input", applySearch);
    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      applySearch();
      searchInput.focus();
    });

    /* =========================================================
       Persist open state (chapters)
       ========================================================= */
    function saveOpenState() {
      const openIds = Array.from(document.querySelectorAll(".chapter.active"))
        .map(ch => ch.id || null)
        .filter(Boolean);
      localStorage.setItem("openChapters", JSON.stringify(openIds));
    }
    function restoreOpenState() {
      try {
        const openIds = JSON.parse(localStorage.getItem("openChapters") || "[]");
        openIds.forEach(id => {
          const ch = document.getElementById(id);
          if (ch && ch.classList.contains("chapter")) setChapterOpen(ch, true);
        });
      } catch {}
    }
    restoreOpenState();

    /* =========================================================
       Theme toggle
       ========================================================= */
    function applyTheme(mode){
      document.documentElement.dataset.theme = mode;
      localStorage.setItem("theme", mode);
    }
    function toggleTheme(){
      const cur = document.documentElement.dataset.theme || "light";
      applyTheme(cur === "light" ? "dark" : "light");
    }
    themeBtn.addEventListener("click", toggleTheme);
    applyTheme(localStorage.getItem("theme") || "light");

    /* =========================================================
       Reading mode + print
       ========================================================= */
    function applyReadingMode(on){
      document.body.classList.toggle("reading", on);
      localStorage.setItem("readingMode", on ? "1" : "0");
      readingBtn.textContent = on ? "ุฅูุบุงุก ูุถุน ุงููุฑุงุกุฉ" : "ูุถุน ุงููุฑุงุกุฉ";
    }
    readingBtn.addEventListener("click", () => {
      applyReadingMode(!document.body.classList.contains("reading"));
    });
    printBtn.addEventListener("click", () => window.print());
    applyReadingMode(localStorage.getItem("readingMode") === "1");

    /* =========================================================
       Keyboard shortcuts
       ========================================================= */
    document.addEventListener("keydown", (e) => {
      const isMac = navigator.platform.toUpperCase().includes("MAC");
      const ctrlOrCmd = isMac ? e.metaKey : e.ctrlKey;

      // "/" focus search
      if (e.key === "/" && !e.target.matches("input, textarea")) {
        e.preventDefault();
        searchInput.focus();
        return;
      }

      // Esc clears search (if focused or if term exists)
      if (e.key === "Escape") {
        if ((document.activeElement === searchInput) || (searchInput.value || "").trim()) {
          searchInput.value = "";
          applySearch();
          searchInput.blur();
        }
        return;
      }

      // Ctrl/Cmd + K => toggle open/close all
      if (ctrlOrCmd && e.key.toLowerCase() === "k") {
        e.preventDefault();
        const anyClosed = chapters.some(ch => !ch.classList.contains("active"));
        chapters.forEach(ch => setChapterOpen(ch, anyClosed));
        saveOpenState();
        return;
      }
    });

    // Expose scrollToSection for compatibility
    window.scrollToSection = scrollToSection;
  </script>
</body>
</html>

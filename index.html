<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f2027" />
  <title>ØªÙ…Ù‡ÙŠØ¯ Ø§Ù„Ø¯Ù„Ø§Ø¦Ù„ â€” Ø§Ù„Ù„Ø§Ù…Ø´ÙŠ (Ù†Ø³Ø®Ø© Ø¯Ø±Ø§Ø³Ø© Ù…ÙˆØ¨Ø§ÙŠÙ„)</title>

  <style>
    :root{
      --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
      --card:#ffffff; --text:#16202a; --muted:#5b6b7a;
      --brand:#1e3c72; --brand2:#2a5298; --gold:#ffd700;
      --border:rgba(0,0,0,.10);
      --shadow: 0 12px 28px rgba(0,0,0,.18);
      --shadow2: 0 10px 22px rgba(0,0,0,.12);
      --radius: 18px;
      --tap: 52px;
      --max: 980px;
      --fs: 18px;
    }
    [data-theme="dark"]{
      --card: rgba(255,255,255,.06);
      --text:#eef5ff;
      --muted:#b9c7d6;
      --border:rgba(255,255,255,.12);
      --shadow: 0 12px 28px rgba(0,0,0,.50);
      --shadow2: 0 10px 22px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: "Amiri","Traditional Arabic",serif;
      font-size: var(--fs);
      line-height: 2.05;
      color: var(--text);
      background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
      min-height:100vh;
      padding-bottom: calc(92px + env(safe-area-inset-bottom));
      -webkit-tap-highlight-color: transparent;
      overflow-x:hidden;
    }

    /* ===== Top hero (lightweight) ===== */
    .hero{
      position:relative;
      padding: 28px 16px 18px;
      text-align:center;
      color:#fff;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,215,0,.20), transparent 40%),
        radial-gradient(circle at 80% 10%, rgba(255,255,255,.10), transparent 45%),
        radial-gradient(circle at 70% 90%, rgba(30,60,114,.25), transparent 45%);
      filter: blur(0px);
      opacity:.9;
    }
    .hero .inner{position:relative; max-width: var(--max); margin:0 auto;}
    .hero h1{
      margin:0 0 8px;
      font-size: 1.7rem;
      line-height:1.5;
      text-shadow: 0 6px 18px rgba(0,0,0,.30);
    }
    .hero .sub{opacity:.95; font-weight:700}
    .hero .author{margin-top:10px; color: var(--gold); font-weight:900; line-height:1.65}

    /* ===== Layout ===== */
    .wrap{max-width: var(--max); margin:0 auto; padding: 10px 12px 0;}
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 16px;
      backdrop-filter: blur(10px);
    }
    .card + .card{margin-top: 12px;}
    .title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin:0 0 10px;
      font-weight: 900;
      color: #fff;
    }

    /* ===== Mobile-first controls ===== */
    .searchRow{
      display:flex; gap:10px; align-items:center;
      position: sticky;
      top: 0;
      z-index: 1200;
      padding: 10px 12px;
      margin: 0 -12px 10px;
      background: rgba(10,14,18,.55);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .searchRow input{
      width:100%;
      height: var(--tap);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: #fff;
      padding: 0 16px;
      font-size: 1rem;
      outline: none;
    }
    .searchRow input::placeholder{color: rgba(255,255,255,.75)}
    .iconBtn{
      height: var(--tap);
      min-width: var(--tap);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight: 900;
      cursor:pointer;
      display:inline-flex;
      align-items:center; justify-content:center;
      padding: 0 12px;
    }
    .iconBtn:active{transform: scale(.98)}
    .pill{
      border-radius: 999px;
      padding: 6px 10px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      color:#fff;
      font-weight: 900;
      font-size: .92rem;
      white-space: nowrap;
    }

    /* ===== Sections ===== */
    .secHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .secHead h2{
      margin:0;
      font-size: 1.25rem;
      color: #fff;
      font-weight: 1000;
    }
    .hint{color: rgba(255,255,255,.85); font-weight:800; font-size:.95rem}

    .box{
      border-radius: 16px;
      padding: 14px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    }
    [data-theme="light"] .box{
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    }

    .hl{background: var(--gold); color: #111; padding: 0 .15rem; border-radius: 6px; font-weight: 900;}

    /* ===== Collapsibles optimized for touch ===== */
    .chapter{
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow:hidden;
      background: rgba(255,255,255,.06);
      transform: translateZ(0);
      box-shadow: none;
    }
    [data-theme="light"] .chapter{ background:#fff; }
    .chapter + .chapter{margin-top: 10px;}
    .chTop{
      display:flex; align-items:center; gap: 10px;
      padding: 12px 12px;
      background: rgba(255,255,255,.06);
    }
    [data-theme="light"] .chTop{ background: rgba(30,60,114,.06); }
    .chTitle{
      flex: 1;
      font-weight: 1000;
      color: #fff;
      font-size: 1.05rem;
      line-height: 1.65;
    }
    [data-theme="light"] .chTitle{ color: var(--brand); }
    .toggleBtn{
      height: 42px;
      padding: 0 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight: 1000;
      cursor:pointer;
      white-space: nowrap;
    }
    [data-theme="light"] .toggleBtn{
      border-color: rgba(30,60,114,.20);
      background: rgba(30,60,114,.08);
      color: var(--brand);
    }
    .toggleBtn:active{transform: scale(.98)}
    .chBody{
      display:none;
      padding: 12px;
      background: rgba(0,0,0,.08);
      border-top: 1px dashed rgba(255,255,255,.16);
    }
    [data-theme="light"] .chBody{
      background: rgba(30,60,114,.03);
      border-top-color: rgba(30,60,114,.18);
    }
    .chapter.active .chBody{display:block}

    /* ===== 3D (subtle + efficient) ===== */
    .tilt3d{
      will-change: transform;
      transition: transform .15s ease, box-shadow .15s ease;
      box-shadow: var(--shadow2);
    }
    .tilt3d:active{
      transform: perspective(900px) rotateX(2deg) rotateY(-2deg) translateY(1px);
      box-shadow: var(--shadow);
    }
    /* respects reduced motion */
    @media (prefers-reduced-motion: reduce){
      .tilt3d, .tilt3d:active{transition:none; transform:none;}
    }

    /* ===== Study tools ===== */
    .studyGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .tool{
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 12px;
      background: rgba(255,255,255,.06);
    }
    [data-theme="light"] .tool{ background:#fff; }
    .tool h3{margin:0 0 6px; font-size: 1.05rem; font-weight: 1000; color:#fff}
    [data-theme="light"] .tool h3{color: var(--brand)}
    .tool p{margin:0; color: var(--muted); font-weight: 800}
    [data-theme="dark"] .tool p{color: rgba(255,255,255,.85)}

    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      height: var(--tap);
      padding: 0 14px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight: 1000;
      cursor:pointer;
    }
    [data-theme="light"] .btn{ background: rgba(30,60,114,.08); color: var(--brand); border-color: rgba(30,60,114,.18); }
    .btn.primary{
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      color:#fff;
      border: 0;
    }
    .btn:active{transform: scale(.98)}

    textarea{
      width:100%;
      min-height: 120px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 12px;
      font-size: 1rem;
      outline:none;
      resize: vertical;
    }
    [data-theme="light"] textarea{ background:#fff; }

    .flash{
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      padding: 12px;
    }
    [data-theme="light"] .flash{ background:#fff; }
    .flash .q{font-weight:1000; margin:0 0 8px}
    .flash .a{display:none; margin:0; color: var(--muted); font-weight:800}
    [data-theme="dark"] .flash .a{color: rgba(255,255,255,.88)}
    .flash.show .a{display:block}

    /* ===== Search results (outside sections so it never gets hidden) ===== */
    .results{
      display:none;
      position: sticky;
      top: calc(var(--tap) + 14px);
      z-index: 1100;
      margin: 0 -12px 10px;
      padding: 10px 12px;
      background: rgba(10,14,18,.60);
      border-bottom: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
    }
    .results .list{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height: 46vh;
      overflow:auto;
      padding-bottom: 4px;
    }
    .resItem{
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      cursor:pointer;
    }
    .resItem h4{margin:0 0 4px; font-size: 1.02rem}
    .resItem p{margin:0; opacity:.9; font-weight:800}
    .resMeta{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom: 8px}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size:.9rem; opacity:.9}

    /* ===== Bottom bar for mobile study ===== */
    .bar{
      position: fixed;
      left: 12px; right: 12px;
      bottom: calc(12px + env(safe-area-inset-bottom));
      z-index: 3000;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 10px;
      padding: 10px;
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      color: #111;
    }
    [data-theme="dark"] .bar{ background: rgba(20,28,36,.92); color: #fff; }
    .bar button{
      border: 0;
      border-radius: 16px;
      height: 52px;
      font-weight: 1000;
      cursor:pointer;
      background: rgba(30,60,114,.10);
      color: inherit;
    }
    [data-theme="dark"] .bar button{ background: rgba(255,255,255,.08); }
    .bar button:active{transform: scale(.98)}

    /* ===== Reading mode ===== */
    body.reading{ --fs: 19px; }
    body.reading .wrap{ max-width: 820px; }
    body.reading .bar{ opacity: .92; }

    /* ===== Print ===== */
    @media print{
      .bar,.searchRow,.results{display:none !important}
      body{background:#fff !important; color:#111 !important; padding-bottom:0 !important}
      .card,.chapter{box-shadow:none !important}
      .chBody{display:block !important}
    }
  </style>
</head>

<body data-theme="light">
  <header class="hero" id="top">
    <div class="inner">
      <h1>ØªÙ…Ù‡ÙŠØ¯ Ø§Ù„Ø¯Ù„Ø§Ø¦Ù„ ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ù…Ø³Ø§Ø¦Ù„ Ø¹Ù„Ù… Ø§Ù„ÙƒÙ„Ø§Ù…</h1>
      <div class="sub">Ù†Ø³Ø®Ø© Ø¯Ø±Ø§Ø³Ø© Ù…Ù‡ÙŠÙ‘Ø£Ø© Ù„Ù„Ù‡Ø§ØªÙ â€” Ø³Ø±ÙŠØ¹Ø© ÙˆØ¨Ø³ÙŠØ·Ø©</div>
      <div class="author">Ø£Ø¨Ùˆ Ø§Ù„Ø«Ù†Ø§Ø¡ Ù…Ø­Ù…ÙˆØ¯ Ø¨Ù† Ø²ÙŠØ¯ Ø§Ù„Ù„Ø§Ù…Ø´ÙŠ</div>
    </div>
  </header>

  <!-- Sticky search row -->
  <div class="wrap">
    <div class="searchRow">
      <input id="q" type="search" placeholder="Ø§Ø¨Ø­Ø«â€¦ (Ù…Ø«Ø§Ù„: Ø§Ù„Ø¯Ù„ÙŠÙ„ØŒ Ø§Ù„Ø­ÙƒÙ…ØŒ Ø­Ø¯ÙˆØ« Ø§Ù„Ø¹Ø§Ù„Ù…)" autocomplete="off" />
      <button class="iconBtn" id="clear" title="Ù…Ø³Ø­">âœ•</button>
      <span class="pill"><span class="kbd">/</span> Ø¨Ø­Ø«</span>
    </div>

    <!-- Results (never hidden) -->
    <div class="results" id="results">
      <div class="resMeta">
        <strong id="resCount">0 Ù†ØªÙŠØ¬Ø©</strong>
        <span class="kbd">Esc Ù„Ù…Ø³Ø­</span>
      </div>
      <div class="list" id="resList"></div>
    </div>

    <!-- Study Tools -->
    <section class="card tilt3d" id="study">
      <div class="secHead">
        <h2>ğŸ§  Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</h2>
        <div class="hint">Ø®ÙÙŠÙØ© + Ù…ÙÙŠØ¯Ø© ÙØ¹Ù„Ø§Ù‹</div>
      </div>

      <div class="studyGrid">
        <div class="tool tilt3d">
          <h3>âœ… Ø®Ø·Ø© Ø¬Ù„Ø³Ø© 25 Ø¯Ù‚ÙŠÙ‚Ø©</h3>
          <p>Ø§Ø¶ØºØ· Â«Ø§Ø¨Ø¯Ø£Â» â€” Ø³ÙŠØ°ÙƒÙ‘Ø±Ùƒ Ø¨Ø§Ù„Ø±Ø§Ø­Ø© Ø¨Ø¹Ø¯ 25 Ø¯Ù‚ÙŠÙ‚Ø© (Ø¨Ø¯ÙˆÙ† Ù†Øª).</p>
          <div class="row" style="margin-top:10px">
            <button class="btn primary" id="pomStart">Ø§Ø¨Ø¯Ø£</button>
            <button class="btn" id="pomStop">Ø¥ÙŠÙ‚Ø§Ù</button>
            <span class="pill" id="pomState">Ø¬Ø§Ù‡Ø²</span>
          </div>
        </div>

        <div class="tool tilt3d">
          <h3>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ø±ÙŠØ¹Ø© (Ù…Ø­ÙÙˆØ¸Ø©)</h3>
          <p>Ø§ÙƒØªØ¨ØŒ ÙˆØ³ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</p>
          <div style="margin-top:10px">
            <textarea id="notes" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµÙƒ Ù‡Ù†Ø§â€¦"></textarea>
            <div class="row" style="margin-top:10px">
              <button class="btn" id="notesClear">Ù…Ø³Ø­ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
              <span class="pill" id="notesSaved">Ù…Ø­ÙÙˆØ¸</span>
            </div>
          </div>
        </div>

        <div class="tool tilt3d">
          <h3>ğŸ´ Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø±Ø§Ø¬Ø¹Ø© (Flashcards)</h3>
          <p>Ø£Ø¶Ù Ø³Ø¤Ø§Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ§Ø¨Ø§Ù‹ â€” Ø«Ù… Ø±Ø§Ø¬Ø¹Ù‡Ø§ Ø¨Ø³Ø±Ø¹Ø©.</p>
          <div style="margin-top:10px">
            <input id="fcQ" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„â€¦" style="width:100%;height:52px;border-radius:16px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);padding:0 12px;font-size:1rem;outline:none" />
            <div style="height:10px"></div>
            <input id="fcA" placeholder="Ø§Ù„Ø¬ÙˆØ§Ø¨â€¦" style="width:100%;height:52px;border-radius:16px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);padding:0 12px;font-size:1rem;outline:none" />
            <div class="row" style="margin-top:10px">
              <button class="btn primary" id="fcAdd">Ø¥Ø¶Ø§ÙØ©</button>
              <button class="btn" id="fcNext">Ø§Ù„ØªØ§Ù„ÙŠ</button>
              <button class="btn" id="fcToggle">Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡</button>
              <button class="btn" id="fcClear">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
              <span class="pill" id="fcCount">0</span>
            </div>
            <div class="flash" id="fcCard" style="margin-top:10px">
              <p class="q" id="fcCardQ">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø¹Ø¯</p>
              <p class="a" id="fcCardA">â€”</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Content: only real sections (no fake padding) -->
    <section class="card tilt3d" id="biography">
      <div class="secHead">
        <h2>ğŸ“œ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø¤Ù„Ù</h2>
        <div class="hint">Ù…Ø®ØªØµØ± Ù…ÙÙŠØ¯</div>
      </div>

      <div class="box">
        <p><span class="hl">Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ® Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„Ø¬Ù„ÙŠÙ„</span> Ø³ÙŠÙ Ø§Ù„Ø­Ù‚ Ù†Ø§ØµØ± Ø§Ù„Ø´Ø±ÙŠØ¹Ø©ØŒ Ø£Ø¨Ùˆ Ø§Ù„Ø«Ù†Ø§Ø¡ Ù…Ø­Ù…ÙˆØ¯ Ø¨Ù† Ø²ÙŠØ¯ Ø§Ù„Ù„Ø§Ù…Ø´ÙŠ.</p>
      </div>

      <div class="box" style="margin-top:10px">
        <strong>Ù†Ø´Ø£ØªÙ‡</strong>
        <p>
          Ù†Ø´Ø£ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ù„Ø§Ù…Ø´ÙŠ ÙÙŠ Ø¨Ù„Ø§Ø¯ Ù…Ø§ ÙˆØ±Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø±ØŒ ÙÙŠ Ø§Ù„Ù‚Ø±ÙŠØ© Ø§Ù„ØªÙŠ ÙŠÙ†Ø³Ø¨ Ø¥Ù„ÙŠÙ‡Ø§ ÙˆÙ‡ÙŠ <span class="hl">Â«Ù„Ø§Ù…Ø´Â»</span>
          Ù…Ù† Ù‚Ø±Ù‰ ÙÙØ±Ù’ØºÙØ§Ù†ÙØ©ÙØŒ ÙˆØªÙ„Ù‚Ù‰ Ø¹Ù† Ù…Ø´Ø§ÙŠØ® Ø¯ÙŠØ§Ø±Ù‡ ÙˆÙŠØ´ÙŠØ± Ø¥Ù„ÙŠÙ‡Ù… Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø¨Ù€Â«Ù…Ø´Ø§ÙŠØ® Ù…Ø§ ÙˆØ±Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø±Â» Ø£Ùˆ Â«Ù…Ø´Ø§ÙŠØ® Ø³Ù…Ø±Ù‚Ù†Ø¯Â» Ø£Ùˆ Â«Ù…Ø´Ø§ÙŠØ® Ø¯ÙŠØ§Ø±Ù†Ø§Â».
        </p>
      </div>

      <div class="box" style="margin-top:10px">
        <strong>ØªØ£Ø±ÙŠØ® ÙˆÙ„Ø§Ø¯ØªÙ‡ ÙˆÙˆÙØ§ØªÙ‡</strong>
        <p>Ù„Ù… ØªÙØ°ÙƒØ± ØªÙˆØ§Ø±ÙŠØ® ÙˆÙ„Ø§Ø¯ØªÙ‡ ÙˆÙˆÙØ§ØªÙ‡ Ø¹Ù„Ù‰ ÙˆØ¬Ù‡Ù Ù‚Ø§Ø·Ø¹ ÙÙŠ ÙƒØªØ¨ Ø§Ù„ØªØ±Ø§Ø¬Ù… Ø§Ù„Ù…Ø´Ù‡ÙˆØ±Ø©.</p>
        <p>ÙˆØ±Ø¯ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ù‚ÙˆÙ„ Ø£Ù†Ù‡ ØªÙˆÙÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† Ø³Ù†Ø© <span class="hl">522Ù‡Ù€</span> ÙˆÙƒØ§Ù† Ø§Ø¨Ù† Ø¥Ø­Ø¯Ù‰ ÙˆØ«Ù…Ø§Ù†ÙŠÙ† Ø³Ù†Ø© (Ù…Ø¹ Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø¶Ø¨Ø· Ø§Ù„ÙŠÙˆÙ…).</p>
      </div>
    </section>

    <section class="card tilt3d" id="introduction">
      <div class="secHead">
        <h2>ğŸšª Ù…Ø¯Ø®Ù„</h2>
        <div class="hint">ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù„Ù… ÙˆÙ…ÙˆØ¶ÙˆØ¹Ù‡</div>
      </div>

      <div class="box">
        Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø±ÙˆØ¹ Ù„Ø§ Ø¨Ø¯ Ù…Ù† Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¹Ù†Ø¯ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª ÙˆØ§Ù„ØªØ¹Ø±ÙŠÙØ§Øª: ØªØ¹Ø±ÙŠÙ Ø¹Ù„Ù… Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆÙ…ÙˆØ¶ÙˆØ¹Ù‡ ÙˆØºØ§ÙŠØªÙ‡ØŒ ÙƒÙŠÙ„Ø§ ÙŠÙ‚Ø¹ Ø·Ø§Ù„Ø¨Ù‡ ÙÙŠ Ø­ÙŠØ±Ø©.
      </div>

      <div class="chapter" id="kalam_defs" style="margin-top:10px">
        <div class="chTop">
          <div class="chTitle">ØªØ¹Ø±ÙŠÙ Ø¹Ù„Ù… Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆÙ…ÙˆØ¶ÙˆØ¹Ù‡ ÙˆØºØ§ÙŠØªÙ‡</div>
          <button class="toggleBtn" type="button">ÙØªØ­</button>
        </div>
        <div class="chBody">
          <div class="box">
            <p><strong>Ø¨Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</strong> Ø¹Ù„Ù… ÙŠØ¨Ø­Ø« ÙÙŠÙ‡ Ø¹Ù† Ø°Ø§Øª Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰ ÙˆØµÙØ§ØªÙ‡ ÙˆØ£Ø­ÙˆØ§Ù„ Ø§Ù„Ù…Ù…ÙƒÙ†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø¨Ø¯Ø£ ÙˆØ§Ù„Ù…Ø¹Ø§Ø¯ Ø¹Ù„Ù‰ Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø³Ù„Ø§Ù….</p>
            <p><strong>Ø¨Ø­Ø³Ø¨ Ø§Ù„ØºØ§ÙŠØ©:</strong> Ø¹Ù„Ù… ÙŠÙ‚ØªØ¯Ø± Ù…Ø¹Ù‡ Ø¹Ù„Ù‰ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø¯ÙŠÙ†ÙŠØ© Ø¨Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø­Ø¬Ø¬ ÙˆØ¯ÙØ¹ Ø§Ù„Ø´Ø¨Ù‡.</p>
            <p><strong>Ø§Ù„ØºØ§ÙŠØ©:</strong> Ø§Ù„ØªØ±Ù‚ÙŠ Ù…Ù† Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù†ØŒ ÙˆØ¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ±Ø´Ø¯ÙŠÙ†ØŒ ÙˆØ­ÙØ¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ø¹Ù† Ø´Ø¨Ù‡ Ø§Ù„Ù…Ø¨Ø·Ù„ÙŠÙ†ØŒ ÙˆÙƒÙˆÙ†Ù‡ Ø£Ø³Ø§Ø³ Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠØ©.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="card tilt3d" id="definitions">
      <div class="secHead">
        <h2>ğŸ“š Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
        <div class="hint">Ù„Ù„ÙÙ‡Ù… Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù†Ø§Ø¸Ø±Ø©</div>
      </div>

      <div class="chapter" id="dalil">
        <div class="chTop">
          <div class="chTitle">Ø§Ù„Ø¯Ù„ÙŠÙ„</div>
          <button class="toggleBtn" type="button">ÙØªØ­</button>
        </div>
        <div class="chBody">
          <div class="box">
            <p><strong>Ù„ØºØ©:</strong> Ø§Ù„Ù…Ø±Ø´Ø¯. ÙˆÙ‚Ø¯ ÙŠÙØ·Ù„Ù‚ Ø¨Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¯Ø§Ù„.</p>
            <p><strong>Ø§ØµØ·Ù„Ø§Ø­Ø§Ù‹:</strong> Ù…Ø§ ÙŠÙØªÙˆØµÙ„ Ø¨Ù‡ Ù…Ù† Ù…Ø¹Ù„ÙˆÙ… Ø¥Ù„Ù‰ Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø¥Ø­ÙƒØ§Ù… Ø§Ù„Ù†Ø¸Ø±.</p>
            <p><strong>Ø£Ù‚Ø³Ø§Ù…Ù‡:</strong> Ø¹Ù‚Ù„ÙŠ (Ù…Ù‚Ø¯Ù…Ø§ØªÙ‡ Ø¹Ù‚Ù„ÙŠØ©) ÙˆØ³Ù…Ø¹ÙŠ (Ù…Ø±ÙƒØ¨ Ù…Ù† Ø¹Ù‚Ù„ÙŠØ© ÙˆØ³Ù…Ø¹ÙŠØ©).</p>
          </div>
        </div>
      </div>

      <div class="chapter" id="hukm">
        <div class="chTop">
          <div class="chTitle">Ø§Ù„Ø­ÙƒÙ…</div>
          <button class="toggleBtn" type="button">ÙØªØ­</button>
        </div>
        <div class="chBody">
          <div class="box">
            <p><strong>Ø¹Ù†Ø¯ Ø£Ù‡Ù„ Ø§Ù„ÙÙ†:</strong> Ø¥Ø«Ø¨Ø§Øª Ø£Ù…Ø± Ù„Ø£Ù…Ø± Ø£Ùˆ Ù†ÙÙŠÙ‡ Ø¹Ù†Ù‡.</p>
            <p><strong>Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø¹Ù‚Ù„ÙŠ:</strong> Ø§Ù„ÙˆØ¬ÙˆØ¨ â€” Ø§Ù„Ø§Ø³ØªØ­Ø§Ù„Ø© â€” Ø§Ù„Ø¥Ù…ÙƒØ§Ù†.</p>
          </div>
        </div>
      </div>

      <div class="chapter" id="wajib">
        <div class="chTop">
          <div class="chTitle">Ø§Ù„ÙˆØ§Ø¬Ø¨ ÙˆØ§Ù„Ù…Ø³ØªØ­ÙŠÙ„ ÙˆØ§Ù„Ù…Ù…ÙƒÙ†</div>
          <button class="toggleBtn" type="button">ÙØªØ­</button>
        </div>
        <div class="chBody">
          <div class="box">
            <p><strong>Ø§Ù„ÙˆØ§Ø¬Ø¨:</strong> Ù…Ø§ Ù„Ù… ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙØ§Ø¡ ÙÙŠ Ø°Ø§ØªÙ‡.</p>
            <p><strong>Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„:</strong> Ù…Ø§ Ù„Ù… ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø«Ø¨ÙˆØª ÙÙŠ Ø°Ø§ØªÙ‡.</p>
            <p><strong>Ø§Ù„Ù…Ù…ÙƒÙ†:</strong> Ù…Ø§ ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø«Ø¨ÙˆØª ÙˆØ§Ù„Ø§Ù†ØªÙØ§Ø¡ Ù„Ø°Ø§ØªÙ‡.</p>
          </div>
        </div>
      </div>

      <div class="chapter" id="ilm">
        <div class="chTop">
          <div class="chTitle">Ø§Ù„Ø¹Ù„Ù… (ØªÙ…Ù‡ÙŠØ¯)</div>
          <button class="toggleBtn" type="button">ÙØªØ­</button>
        </div>
        <div class="chBody">
          <div class="box">
            <p>Ù…Ù† Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„Ù…: Ø§Ù„Ø­ÙˆØ§Ø³ Ø§Ù„Ø³Ù„ÙŠÙ…Ø©ØŒ ÙˆØ§Ù„Ø¹Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…Ø©ØŒ ÙˆØ§Ù„Ø®Ø¨Ø± Ø§Ù„ØµØ§Ø¯Ù‚.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="card tilt3d" id="chapters">
      <div class="secHead">
        <h2>ğŸ§© ÙØµÙˆÙ„ Ù…Ø®ØªØ§Ø±Ø©</h2>
        <div class="hint">Ù…Ø®ØªØµØ±Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙˆØ³Ø¹Ø©</div>
      </div>

      <div class="chapter" id="haqaiq">
        <div class="chTop">
          <div class="chTitle">ÙØµÙ„ ÙÙŠ Ø«Ø¨ÙˆØª Ø­Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡</div>
          <button class="toggleBtn" type="button">ÙØªØ­</button>
        </div>
        <div class="chBody">
          <div class="box">
            <p>Ø­Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø«Ø§Ø¨ØªØ©ØŒ ÙˆÙ‡Ùˆ Ù…Ø°Ù‡Ø¨ Ø¹Ø§Ù…Ø© Ø§Ù„Ø¹Ù‚Ù„Ø§Ø¡.</p>
            <p><strong>Ø´Ø¨Ù‡Ø© Ø§Ù„Ø³ÙˆÙØ³Ø·Ø§Ø¦ÙŠØ©:</strong> Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ø¥Ø¯Ø±Ø§ÙƒØ› ÙƒØ§Ù„Ø£Ø­ÙˆÙ„ ÙŠØ±Ù‰ Ø§Ù„Ø´ÙŠØ¡ Ø´ÙŠØ¦ÙŠÙ†â€¦</p>
            <p><strong>Ø§Ù„Ø¬ÙˆØ§Ø¨:</strong> Ù‡Ù„ Ù„Ù†ÙÙŠÙƒÙ… Ø­Ù‚ÙŠÙ‚Ø©ØŸ Ø¥Ù† Ù‚Ø§Ù„ÙˆØ§ Ù„Ø§ Ø³Ù‚Ø·ØŒ ÙˆØ¥Ù† Ù‚Ø§Ù„ÙˆØ§ Ù†Ø¹Ù… Ø£Ø«Ø¨ØªÙˆØ§ Ø­Ù‚ÙŠÙ‚Ø© Ø´ÙŠØ¡.</p>
          </div>
        </div>
      </div>

      <div class="chapter" id="huduth">
        <div class="chTop">
          <div class="chTitle">ÙØµÙ„ ÙÙŠ Ø¥Ø«Ø¨Ø§Øª Ø­Ø¯ÙˆØ« Ø§Ù„Ø¹Ø§Ù„Ù… ÙˆØ«Ø¨ÙˆØª Ø§Ù„ØµØ§Ù†Ø¹ ÙˆÙ‚Ø¯Ù…Ù‡</div>
          <button class="toggleBtn" type="button">ÙØªØ­</button>
        </div>
        <div class="chBody">
          <div class="box">
            <p><strong>Ø§Ù„Ø¹Ø§Ù„Ù…:</strong> Ù…Ø§ Ø³ÙˆÙ‰ Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰ Ù…Ù† Ø§Ù„Ø³Ù…ÙˆØ§Øª ÙˆØ§Ù„Ø£Ø±Ø¶ÙŠÙ† ÙˆÙ…Ø§ ÙÙŠÙ‡Ø§.</p>
            <p><strong>ØªÙ‚Ø³ÙŠÙ…:</strong> Ø£Ø¹Ø±Ø§Ø¶ â€” Ø¬ÙˆØ§Ù‡Ø± â€” Ø£Ø¬Ø³Ø§Ù….</p>
            <p><strong>Ù…Ø®ØªØµØ± Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø­Ø§Ø¯Ø«Ø© Ù„ØªØ¨Ø¯Ù„Ù‡Ø§ØŒ ÙˆÙ…Ø§ Ù„Ø§ ÙŠØ®Ù„Ùˆ Ø¹Ù† Ø§Ù„Ø­ÙˆØ§Ø¯Ø« ÙÙ‡Ùˆ Ø­Ø§Ø¯Ø«ØŒ ÙˆØ§Ù„Ø­Ø§Ø¯Ø« ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…ÙØ­Ø¯ÙØ«.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="card tilt3d" id="proofs">
      <div class="secHead">
        <h2>ğŸ§  Ø§Ù„Ø£Ø¯Ù„Ø© (Ù…Ù„Ø®Øµ Ø¹Ù…Ù„ÙŠ)</h2>
        <div class="hint">Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</div>
      </div>

      <div class="box">
        <p><strong>Ù¡) ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§Ø³ØªØ¯Ù„Ø§Ù„:</strong> ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚ ÙˆØ·Ø±Ù‚ Ø§Ù„Ø¹Ù„Ù… â†’ Ø­Ø¯ÙˆØ« Ø§Ù„Ø¹Ø§Ù„Ù… â†’ Ø«Ø¨ÙˆØª Ø§Ù„ØµØ§Ù†Ø¹ â†’ Ù‚ÙØ¯Ù…Ù‡.</p>
        <p><strong>Ù¢) Ø­Ø¯ÙˆØ« Ø§Ù„Ø¹Ø§Ù„Ù…:</strong> Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ØªØªØ¨Ø¯Ù„ ÙÙ‡ÙŠ Ø­Ø§Ø¯Ø«Ø©ØŒ ÙˆØ§Ù„Ø£Ø¹ÙŠØ§Ù† Ù„Ø§ ØªØ®Ù„Ùˆ Ø¹Ù†Ù‡Ø§ØŒ ÙØ§Ù„Ø¹Ø§Ù„Ù… Ø­Ø§Ø¯Ø«.</p>
        <p><strong>Ù£) Ø«Ø¨ÙˆØª Ø§Ù„ØµØ§Ù†Ø¹:</strong> Ø§Ù„Ø­Ø§Ø¯Ø« Ù„Ø§ Ø¨Ø¯ Ù„Ù‡ Ù…Ù† Ù…ÙØ­Ø¯ÙØ«ØŒ ÙˆØ§Ø³ØªØ­Ø§Ù„Ø© Ø£Ù† ÙŠÙØ­Ø¯Ø« Ø§Ù„Ø´ÙŠØ¡ Ù†ÙØ³Ù‡.</p>
        <p><strong>Ù¤) Ù‚ÙØ¯Ù… Ø§Ù„ØµØ§Ù†Ø¹:</strong> Ù„Ùˆ ÙƒØ§Ù† Ø­Ø§Ø¯Ø«Ø§Ù‹ Ù„Ø§Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…ÙØ­Ø¯ÙØ« ÙÙŠÙ„Ø²Ù… Ø§Ù„Ø¯ÙˆØ± Ø£Ùˆ Ø§Ù„ØªØ³Ù„Ø³Ù„.</p>
      </div>
    </section>

    <section class="card tilt3d" id="tips">
      <div class="secHead">
        <h2>ğŸ¯ Ø·Ø±ÙŠÙ‚Ø© Ù…Ø°Ø§ÙƒØ±Ø© Ø³Ø±ÙŠØ¹Ø©</h2>
        <div class="hint">Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</div>
      </div>
      <div class="box">
        <ol style="margin:0; padding: 0 20px 0 0; font-weight:900; color: var(--text)">
          <li>Ø§Ù‚Ø±Ø£ ØªØ¹Ø±ÙŠÙØ§Øª (Ø§Ù„Ø¯Ù„ÙŠÙ„/Ø§Ù„Ø­ÙƒÙ…) â†’ Ø§ÙƒØªØ¨ Ø³Ø·Ø±ÙŠÙ† ÙÙŠ Â«Ù…Ù„Ø§Ø­Ø¸Ø§ØªÂ».</li>
          <li>Ø§ÙØªØ­ Â«Ø­Ø¯ÙˆØ« Ø§Ù„Ø¹Ø§Ù„Ù…Â» â†’ Ù„Ø®Øµ Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙÙŠ 3 Ø¬Ù…Ù„.</li>
          <li>Ø­ÙˆÙ‘Ù„ Ø§Ù„Ù…Ù„Ø®Øµ Ø¥Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø§Øª (Ø³Ø¤Ø§Ù„/Ø¬ÙˆØ§Ø¨).</li>
          <li>Ø¬Ù„Ø³Ø© 25 Ø¯Ù‚ÙŠÙ‚Ø© Ø«Ù… Ø±Ø§Ø­Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚.</li>
        </ol>
      </div>
    </section>
  </div>

  <!-- Bottom bar (mobile app feel) -->
  <nav class="bar" aria-label="Ø´Ø±ÙŠØ· Ø³Ø±ÙŠØ¹">
    <button type="button" id="bTop">â¬†</button>
    <button type="button" id="bSearch">ğŸ”</button>
    <button type="button" id="bTheme">ğŸŒ™</button>
    <button type="button" id="bRead">ğŸ“–</button>
  </nav>

  <script>
    // ===== Utilities =====
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    function scrollToId(id){
      const el = document.getElementById(id);
      if(!el) return;
      el.scrollIntoView({behavior:"smooth", block:"start"});
    }

    // ===== Theme =====
    function applyTheme(t){
      document.body.dataset.theme = t;
      localStorage.setItem("lamshi_theme", t);
      $("#bTheme").textContent = (t === "dark") ? "â˜€ï¸" : "ğŸŒ™";
    }
    applyTheme(localStorage.getItem("lamshi_theme") || "light");
    $("#bTheme").addEventListener("click", ()=> applyTheme(document.body.dataset.theme === "dark" ? "light":"dark"));

    // ===== Reading mode =====
    function setReading(on){
      document.body.classList.toggle("reading", on);
      localStorage.setItem("lamshi_read", on ? "1":"0");
      $("#bRead").textContent = on ? "ğŸ§¾" : "ğŸ“–";
    }
    setReading(localStorage.getItem("lamshi_read")==="1");
    $("#bRead").addEventListener("click", ()=> setReading(!document.body.classList.contains("reading")));

    // ===== Collapsibles with dedicated button =====
    function syncToggle(ch){
      const btn = $(".toggleBtn", ch);
      if(!btn) return;
      btn.textContent = ch.classList.contains("active") ? "Ø¥ØºÙ„Ø§Ù‚" : "ÙØªØ­";
    }
    const chapters = $$(".chapter");
    chapters.forEach(ch => {
      const btn = $(".toggleBtn", ch);
      if(!btn) return;
      syncToggle(ch);
      btn.addEventListener("click", (e)=>{
        e.stopPropagation();
        ch.classList.toggle("active");
        syncToggle(ch);
        saveOpen();
      });
    });

    // Persist opened chapters
    function saveOpen(){
      const openIds = chapters.filter(c=>c.classList.contains("active")).map(c=>c.id).filter(Boolean);
      localStorage.setItem("lamshi_open", JSON.stringify(openIds));
    }
    function restoreOpen(){
      try{
        const open = JSON.parse(localStorage.getItem("lamshi_open") || "[]");
        open.forEach(id=>{
          const ch = document.getElementById(id);
          if(ch && ch.classList.contains("chapter")) ch.classList.add("active");
        });
        chapters.forEach(syncToggle);
      }catch{}
    }
    restoreOpen();

    // ===== Search with results + highlight =====
    const q = $("#q");
    const clearBtn = $("#clear");
    const results = $("#results");
    const resList = $("#resList");
    const resCount = $("#resCount");

    function clearMarks(root){
      $$("mark", root).forEach(m=>{
        const t = document.createTextNode(m.textContent);
        m.replaceWith(t);
      });
    }

    function markTerm(root, term){
      const esc = term.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      const re = new RegExp(esc, "gi");
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
        acceptNode(node){
          if(!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
          const p = node.parentElement;
          if(!p) return NodeFilter.FILTER_REJECT;
          if(["SCRIPT","STYLE"].includes(p.tagName)) return NodeFilter.FILTER_REJECT;
          return NodeFilter.FILTER_ACCEPT;
        }
      });
      const nodes=[];
      while(walker.nextNode()) nodes.push(walker.currentNode);
      nodes.forEach(tn=>{
        const val = tn.nodeValue;
        if(!re.test(val)) return;
        const frag = document.createDocumentFragment();
        let last=0;
        val.replace(re,(m,off)=>{
          frag.appendChild(document.createTextNode(val.slice(last, off)));
          const mk = document.createElement("mark");
          mk.className = "hl";
          mk.textContent = m;
          frag.appendChild(mk);
          last = off + m.length;
          return m;
        });
        frag.appendChild(document.createTextNode(val.slice(last)));
        tn.parentNode.replaceChild(frag, tn);
      });
    }

    function snippet(el, term, max=150){
      const txt = (el.textContent||"").replace(/\s+/g," ").trim();
      const i = txt.toLowerCase().indexOf(term.toLowerCase());
      if(i<0) return txt.slice(0,max) + (txt.length>max?"â€¦":"");
      const s = Math.max(0, i-45);
      const e = Math.min(txt.length, i+max);
      return (s>0?"â€¦":"") + txt.slice(s,e) + (e<txt.length?"â€¦":"");
    }

    function applySearch(){
      const term = (q.value||"").trim();
      clearMarks(document.body);
      resList.innerHTML = "";
      results.style.display = "none";

      if(!term) return;

      markTerm(document.body, term);

      // build results: chapters + cards
      const hits = [];
      // Prefer chapters
      chapters.forEach(ch=>{
        if(ch.querySelector("mark.hl")){
          ch.classList.add("active");
          syncToggle(ch);
          hits.push({
            title: $(".chTitle", ch)?.textContent?.trim() || "Ù†ØªÙŠØ¬Ø©",
            id: ch.id,
            snip: snippet(ch, term)
          });
        }
      });
      // Then cards/sections
      $$(".card").forEach(card=>{
        if(card.querySelector("mark.hl") && !hits.some(h=>h.id===card.id)){
          if(card.id){
            hits.push({ title: card.querySelector("h2")?.textContent?.trim() || "Ù†ØªÙŠØ¬Ø©", id: card.id, snip: snippet(card, term) });
          }
        }
      });

      results.style.display = "";
      resCount.textContent = `${hits.length} Ù†ØªÙŠØ¬Ø©`;
      hits.slice(0, 30).forEach((h, idx)=>{
        const d = document.createElement("div");
        d.className = "resItem";
        d.innerHTML = `<h4>${h.title}</h4><p>${h.snip}</p>`;
        d.addEventListener("click", ()=>{
          scrollToId(h.id);
          const ch = document.getElementById(h.id);
          if(ch && ch.classList.contains("chapter")){ ch.classList.add("active"); syncToggle(ch); saveOpen(); }
        });
        resList.appendChild(d);
      });
      if(hits.length>30){
        const more = document.createElement("div");
        more.className = "resItem";
        more.innerHTML = `<h4>Ù…Ù„Ø§Ø­Ø¸Ø©</h4><p>Ø£ÙØ¸Ù‡Ø±Øª Ø£ÙˆÙ„ 30 Ù†ØªÙŠØ¬Ø© ÙÙ‚Ø· â€” Ø¶ÙŠÙ‘Ù‚ Ø§Ù„Ø¨Ø­Ø«.</p>`;
        resList.appendChild(more);
      }
      saveOpen();
    }

    q.addEventListener("input", applySearch);
    clearBtn.addEventListener("click", ()=>{ q.value=""; applySearch(); q.focus(); });

    // Hotkeys (desktop / external keyboard)
    window.addEventListener("keydown", (e)=>{
      if(e.key === "/"){ e.preventDefault(); q.focus(); }
      if(e.key === "Escape"){ q.value=""; applySearch(); }
      if(e.key.toLowerCase() === "t"){ applyTheme(document.body.dataset.theme === "dark" ? "light":"dark"); }
      if(e.key.toLowerCase() === "r"){ setReading(!document.body.classList.contains("reading")); }
    });

    // Bottom bar actions
    $("#bTop").addEventListener("click", ()=> scrollToId("top"));
    $("#bSearch").addEventListener("click", ()=> { q.focus(); window.scrollTo({top:0, behavior:"smooth"}); });

    // ===== Notes (autosave) =====
    const notes = $("#notes");
    const notesSaved = $("#notesSaved");
    notes.value = localStorage.getItem("lamshi_notes") || "";
    let notesTimer = null;
    notes.addEventListener("input", ()=>{
      notesSaved.textContent = "ÙŠØ­ÙØ¸â€¦";
      clearTimeout(notesTimer);
      notesTimer = setTimeout(()=>{
        localStorage.setItem("lamshi_notes", notes.value);
        notesSaved.textContent = "Ù…Ø­ÙÙˆØ¸";
      }, 350);
    });
    $("#notesClear").addEventListener("click", ()=>{
      if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŸ")) return;
      notes.value = "";
      localStorage.setItem("lamshi_notes", "");
      notesSaved.textContent = "Ù…Ø­ÙÙˆØ¸";
    });

    // ===== Pomodoro (25/5) =====
    let pomInt = null, pomEnd = 0;
    const pomState = $("#pomState");
    function fmt(ms){
      const s = Math.max(0, Math.floor(ms/1000));
      const m = Math.floor(s/60);
      const r = s%60;
      return `${m}:${String(r).padStart(2,"0")}`;
    }
    function pomTick(){
      const left = pomEnd - Date.now();
      if(left <= 0){
        clearInterval(pomInt); pomInt=null;
        pomState.textContent = "Ø§Ù†ØªÙ‡Øª âœ… (Ø±Ø§Ø­Ø© 5)";
        try{ navigator.vibrate?.([120,80,120]); }catch{}
        return;
      }
      pomState.textContent = "Ù…ØªØ¨Ù‚ÙŠ " + fmt(left);
    }
    $("#pomStart").addEventListener("click", ()=>{
      if(pomInt) return;
      pomEnd = Date.now() + 25*60*1000;
      pomState.textContent = "Ù…ØªØ¨Ù‚ÙŠ 25:00";
      pomInt = setInterval(pomTick, 500);
      pomTick();
    });
    $("#pomStop").addEventListener("click", ()=>{
      clearInterval(pomInt); pomInt=null;
      pomState.textContent = "Ø¬Ø§Ù‡Ø²";
    });

    // ===== Flashcards =====
    const fcQ = $("#fcQ"), fcA = $("#fcA");
    const fcAdd = $("#fcAdd"), fcNext = $("#fcNext"), fcToggle = $("#fcToggle"), fcClear = $("#fcClear");
    const fcCount = $("#fcCount"), fcCard = $("#fcCard"), fcCardQ = $("#fcCardQ"), fcCardA = $("#fcCardA");
    let cards = [];
    let idx = 0;

    function loadCards(){
      try{ cards = JSON.parse(localStorage.getItem("lamshi_fc")||"[]"); }catch{ cards=[]; }
      idx = 0;
      renderCard();
    }
    function saveCards(){
      localStorage.setItem("lamshi_fc", JSON.stringify(cards));
      fcCount.textContent = String(cards.length);
    }
    function renderCard(){
      fcCount.textContent = String(cards.length);
      if(!cards.length){
        fcCard.classList.remove("show");
        fcCardQ.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø¹Ø¯";
        fcCardA.textContent = "â€”";
        return;
      }
      idx = (idx + cards.length) % cards.length;
      const c = cards[idx];
      fcCard.classList.remove("show");
      fcCardQ.textContent = c.q;
      fcCardA.textContent = c.a;
    }

    fcAdd.addEventListener("click", ()=>{
      const qv = (fcQ.value||"").trim();
      const av = (fcA.value||"").trim();
      if(!qv || !av) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø¬ÙˆØ§Ø¨.");
      cards.unshift({q:qv, a:av, t:Date.now()});
      fcQ.value=""; fcA.value="";
      idx = 0;
      saveCards();
      renderCard();
    });
    fcNext.addEventListener("click", ()=>{
      if(!cards.length) return;
      idx = (idx + 1) % cards.length;
      renderCard();
    });
    fcToggle.addEventListener("click", ()=>{
      if(!cards.length) return;
      fcCard.classList.toggle("show");
    });
    fcClear.addEventListener("click", ()=>{
      if(!confirm("Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§ØªØŸ")) return;
      cards = [];
      saveCards();
      renderCard();
    });

    loadCards();
    saveCards();
  </script>
</body>
</html>
